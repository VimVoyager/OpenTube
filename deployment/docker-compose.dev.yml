# Development environment - supports hot-reload and debugging
# Uses separate ports to avoid conflicts with production deployment

services:
  frontend:
    image: opentube-frontend:dev
    build:
      context: ../OpenTube-Frontend
      dockerfile: dockerfile
      args:
        - NODE_ENV=development
    ports:
      - "3200:3000"  # Development port
    volumes:
      # Mount source for hot-reload
      - ../OpenTube-Frontend/src:/app/src:ro
      - ../OpenTube-Frontend/static:/app/static:ro
    environment:
      - NODE_ENV=development
      - PUBLIC_API_URL=http://localhost/api
      - PUBLIC_PROXY_URL=http://localhost/proxy
    depends_on:
      - proxy
      - backend
    restart: unless-stopped
    networks:
      - opentube-dev-network
    command: npm run dev -- --host 0.0.0.0

  proxy:
    image: opentube-proxy:dev
    build:
      context: ../OpenTubeStreamProxy
      dockerfile: dockerfile
      args:
        - BUILD_ENV=development
    ports:
      - "8281:8081"
    environment:
      - GIN_MODE=debug
      - LOG_LEVEL=debug
    restart: unless-stopped
    networks:
      - opentube-dev-network

  backend:
    image: opentube-backend:dev
    build:
      context: ../NewPipeExtractorApi
      dockerfile: dockerfile
      args:
        - BUILD_PROFILE=dev
    ports:
      - "8280:8080"  # Development port
      - "5005:5005"  # Java debug port
    volumes:
      - backend-dev-data:/app/data
      # Optional: mount for hot-reload if using Spring DevTools
      # - ../NewPipeExtractorApi/target/classes:/app/classes
    environment:
      - SPRING_PROFILES_ACTIVE=dev
      - JAVA_OPTS=-Xmx512m -Xms256m -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005
      - LOGGING_LEVEL_ROOT=INFO
      - LOGGING_LEVEL_COM_OPENTUBE=DEBUG
    restart: unless-stopped
    networks:
      - opentube-dev-network

volumes:
  backend-dev-data:
    driver: local

networks:
  opentube-dev-network:
    driver: bridge
